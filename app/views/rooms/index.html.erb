<div class="max-w-2xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">Rooms</h1>
    <%= link_to "Add Room", new_room_path, class: "bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" %>
  </div>

  <% if @rooms.any? %>
    <div class="space-y-4">
      <% @rooms.each do |room| %>
        <div class="bg-white rounded-lg shadow p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-3">
              <% score = room.score %>
              <span class="inline-block w-3 h-3 rounded-full" style="background-color: <%= score_color(score) %>"></span>
              <span class="font-medium text-lg"><%= room.name %></span>
              <span class="text-sm text-gray-500"><%= score.nil? ? "--" : score %></span>
            </div>
            <div class="flex items-center gap-2 text-sm">
              <%= link_to "Add Task", new_room_task_path(room), class: "text-blue-600 hover:underline" %>
              <%= link_to "Edit", edit_room_path(room), class: "text-blue-600 hover:underline" %>
              <%= button_to "Delete", room_path(room), method: :delete,
                    class: "text-red-600 hover:underline",
                    data: { turbo_confirm: "Delete #{room.name} and all its tasks?" } %>
            </div>
          </div>

          <% if room.tasks.any? %>
            <div class="ml-6 space-y-1">
              <% room.tasks.each do |task| %>
                <% health = task.health_score %>
                <div class="flex items-center justify-between text-sm py-1">
                  <div class="flex items-center gap-2">
                    <span class="inline-block w-2 h-2 rounded-full" style="background-color: <%= score_color(health) %>"></span>
                    <span><%= task.name %></span>
                    <span class="text-gray-400">(<%= health %>, every <%= pluralize(task.decay_period_days, "day") %>)</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <%= link_to "Edit", edit_room_task_path(room, task), class: "text-blue-600 hover:underline" %>
                    <%= button_to "Delete", room_task_path(room, task), method: :delete,
                          class: "text-red-600 hover:underline",
                          data: { turbo_confirm: "Delete task #{task.name}?" } %>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12 text-gray-500">
      <p class="mb-4">No rooms yet.</p>
      <%= link_to "Add your first room", new_room_path, class: "text-blue-600 hover:underline" %>
    </div>
  <% end %>
</div>
