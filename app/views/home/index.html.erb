<%= turbo_stream_from :house_scores %>

<div class="max-w-lg mx-auto">
  <% if @rooms.any? %>
    <%# House score with gradient background %>
    <div class="rounded-2xl p-6 mb-6 text-center text-white"
         style="background: linear-gradient(135deg, <%= score_color(@house_score) %>, <%= score_color_light(@house_score) %>);">
      <div class="text-7xl font-bold"><%= @house_score || "--" %></div>
    </div>

    <%# Room list %>
    <div class="space-y-3">
      <% @rooms.each do |room| %>
        <a href="<%= room_tasks_path(room) %>"
           data-turbo-frame="modal"
           class="flex items-center justify-between bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow border-b-4"
           style="border-bottom-color: <%= score_color(room.score) %>;">
          <span class="font-semibold text-gray-800 text-lg"><%= room.name %></span>
          <%# Circular progress indicator %>
          <div class="relative w-12 h-12 flex-shrink-0">
            <svg viewBox="0 0 36 36" class="w-12 h-12 -rotate-90">
              <circle cx="18" cy="18" r="15.5" fill="none" stroke="#e5e7eb" stroke-width="3" />
              <circle cx="18" cy="18" r="15.5" fill="none"
                      stroke="<%= score_color(room.score) %>"
                      stroke-width="3"
                      stroke-dasharray="<%= (room.score || 0) * 0.9742 %> 97.42"
                      stroke-linecap="round" />
            </svg>
            <span class="absolute inset-0 flex items-center justify-center text-xs font-bold"
                  style="color: <%= score_color(room.score) %>">
              <%= room.score || "--" %>
            </span>
          </div>
        </a>
      <% end %>
    </div>
  <% else %>
    <%# Empty state: inline add room form %>
    <div class="text-center py-12">
      <h2 class="text-xl font-semibold text-gray-700 mb-2">No rooms yet</h2>
      <p class="text-gray-500 mb-6">Add your first room to start tracking</p>
      <%= form_with model: Room.new, class: "max-w-xs mx-auto flex gap-2" do |f| %>
        <%= f.text_field :name, placeholder: "Room name", required: true,
            class: "flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        <%= f.submit "Add", class: "bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 cursor-pointer" %>
      <% end %>
    </div>
  <% end %>
</div>

<%# Modal container for room tasks %>
<turbo-frame id="modal"></turbo-frame>
